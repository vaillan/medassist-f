<div
    class="justify-center min-h-full place-items-center px-6 py-24 sm:py-32 lg:px-8"
>
    <mat-divider></mat-divider>
    <div class="grid grid-cols-1 mt-5">
        <div class="col-span-1">
            <div class="table-content mat-elevation-z0">
                <div class="table-container">
                    <table
                        mat-table
                        [dataSource]="groupsDataSource"
                        class="mat-elevation-z8"
                        multiTemplateDataRows
                    >
                        @for (column of displayedColumnsGroups; track column) {
                        <ng-container matColumnDef="{{ column }}">
                            <th mat-header-cell *matHeaderCellDef>
                                {{ column }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{ element[column] }}
                            </td>
                        </ng-container>
                        }
                        <ng-container matColumnDef="expand">
                            <th
                                mat-header-cell
                                *matHeaderCellDef
                                aria-label="row actions"
                            >
                                &nbsp;
                            </th>
                            <td mat-cell *matCellDef="let element">
                                <button
                                    mat-icon-button
                                    aria-label="expand row"
                                    (click)="
                                        expandedElement =
                                            expandedElement === element
                                                ? null
                                                : element;
                                        $event.stopPropagation()
                                    "
                                >
                                    @if (expandedElement === element) {
                                    <mat-icon>keyboard_arrow_up</mat-icon>
                                    } @else {
                                    <mat-icon>keyboard_arrow_down</mat-icon>
                                    }
                                </button>
                            </td>
                        </ng-container>

                        <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
                        <ng-container matColumnDef="expandedDetail">
                            <td
                                mat-cell
                                *matCellDef="let element"
                                [attr.colspan]="
                                    columnsToDisplayWithExpand.length
                                "
                            >
                                <div
                                    class="pr-element-detail"
                                    [@detailExpand]="
                                        element === expandedElement
                                            ? 'expanded'
                                            : 'collapsed'
                                    "
                                >
                                    <!-- Columna de Permisos -->
                                    <mat-checkbox
                                        *ngFor="let permission of permisos"
                                        [ngModel]="
                                            getPermission(element, permission)
                                        "
                                        (change)="
                                            updatePermissions(
                                                element,
                                                permission,
                                                $event
                                            )
                                        "
                                        class="min-w-80"
                                    >
                                        {{ permission.name }}
                                    </mat-checkbox>
                                </div>
                            </td>
                        </ng-container>

                        <tr
                            mat-header-row
                            *matHeaderRowDef="columnsToDisplayWithExpand"
                        ></tr>
                        <tr
                            class="pr-element-row"
                            mat-row
                            *matRowDef="
                                let element;
                                columns: columnsToDisplayWithExpand
                            "
                            [class.pr-expanded-row]="
                                expandedElement === element
                            "
                            (click)="
                                expandedElement =
                                    expandedElement === element ? null : element
                            "
                        ></tr>
                        <tr
                            mat-row
                            *matRowDef="let row; columns: ['expandedDetail']"
                            class="pr-detail-row"
                        ></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
